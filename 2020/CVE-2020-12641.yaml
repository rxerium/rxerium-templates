id: CVE-2020-12641

info:
  name: CVE-2020-12641 - Roundcube Webmail Remote Code Execution
  author: rxerium
  severity: critical
  description: |
    Roundcube Webmail versions before 1.2.10, 1.3.11, and 1.4.4 contain a critical remote code execution vulnerability in rcube_image.php. The vulnerability allows attackers to execute arbitrary code via shell metacharacters in a configuration setting for im_convert_path or im_identify_path. The issue stems from Roundcube not sanitizing shell metacharacters recovered from variables in its configuration settings. This vulnerability was actively exploited by Russian state-sponsored APT28 group in espionage campaigns, particularly targeting organizations with phishing emails containing Ukrainian war news exploits.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-12641
    - https://socprime.com/blog/cve-2020-35730-cve-2021-44026-cve-2020-12641-exploit-detection-apt28-group-abuses-roundcube-flaws-in-spearphishing-espionage-attacks/
    - https://csirt.csi.cip.gov.ua/en/posts/apt28-group
    - https://github.com/DrunkenShells/Disclosures/tree/master/CVE-2020-12641-Command%20Injection-Roundcube
    - https://roundcube.net/news/2020/04/29/security-updates-1.4.4-1.3.11-and-1.2.10
  metadata:
    vendor: Roundcube
    product: Roundcube Webmail
    cvss-score: 9.8
    cwe-id: CWE-78
    cisa-kev: false
    verified: true
  tags: cve,cve2020,roundcube,rce

http:
  - method: GET
    path:
      - "{{BaseURL}}"

    extractors:
      - type: regex
        name: major
        group: 1
        regex:
          - '"rcversion":(\d)'
        internal: true

      - type: regex
        name: minor
        group: 1
        regex:
          - '"rcversion":\d\d(\d)'
        internal: true

      - type: regex
        name: patch
        group: 1
        regex:
          - '"rcversion":\d\d\d(\d+)'
        internal: true

      - type: dsl
        name: version
        dsl:
          - major + "." + minor + "." + patch
        internal: true

      - type: dsl
        dsl:
          - '"Roundcube Version: "+ version'

    matchers-condition: and
    matchers:
      - type: dsl
        name: vulnerable
        dsl:
          - compare_versions(version, '< 1.2.10') || (compare_versions(version,'>= 1.3.0') && compare_versions(version, '< 1.3.11')) || (compare_versions(version,'>= 1.4.0') && compare_versions(version, '< 1.4.4'))

      - type: word
        part: body
        words:
          - "Roundcube"

      - type: status
        status:
          - 200
