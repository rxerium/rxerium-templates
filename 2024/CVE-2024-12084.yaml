id: CVE-2024-12084

info:
  name: CVE-2024-12084 - rsync Daemon Heap Buffer Overflow
  author: rxerium
  severity: critical
  description: |
    rsync versions 3.2.7 through 3.3.0 are affected by a critical heap-based buffer overflow vulnerability in the rsync daemon. The flaw stems from improper handling of attacker-controlled checksum lengths (s2length) in the code. When MAX_DIGEST_LEN exceeds the fixed SUM_LENGTH (16 bytes), an attacker can write out of bounds in the sum2 buffer, leading to potential remote code execution without authentication. This vulnerability affects over 600,000 systems exposed to the Internet and enables attackers to execute arbitrary code with the privileges of the rsync daemon.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-12084
    - https://www.sysdig.com/blog/detecting-and-mitigating-cve-2024-12084-rsync-remote-code-execution
    - https://access.redhat.com/security/cve/cve-2024-12084
    - https://www.wiz.io/vulnerability-database/cve/cve-2024-12084
  metadata:
    verified: true
    max-request: 1
    shodan-query: rsync 31.0
    vendor: Samba
    product: rsync
    cvss-score: 9.8
    cwe-id: CWE-787
    cisa-kev: false
  tags: cve,cve2024,rsync,rce,buffer-overflow

javascript:
  - pre-condition: |
      isPortOpen(Host,Port);
    code: |
      let m = require('nuclei/rsync');
      let response = m.IsRsync(Host,Port);
      Export(response);

    args:
      Host: "{{Host}}"
      Port: 873

    matchers:
      - type: word
        words:
          - "31.0"

    extractors:
      - type: json
        name: version
        json:
          - .Banner
